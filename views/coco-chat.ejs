<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <link rel="stylesheet" href="/bootstrap3/css/bootstrap.css"/>
    <script type="text/javascript" src="/Jquery/jquery-lib-2.11.js"></script>
    <script type="text/javascript" src="/Socket.io/socket.io-1.2.0.js"></script>
    <script type="text/javascript" src="/AngularJs/angular.js"></script>
    <script type="text/javascript" src="/AngularJs/angular-route.js"></script>
    <script type="text/javascript">
        var client = io.connect('http://127.0.0.1:8089');
        client.on('connect',function() {
            console.log('Client has connected to the server!');
        });
        client.on('CHAT_MESSAGE',function(data) {
            console.log(data);
            $('#chat-history').append('<li>'+data+'</li>');
         });
        client.on('LOGIN_MESSAGE_SUCCESS',function(data){
            $('#login_status').html('<p style="color: #09c"> Session ID:'+data+'</p>');
        });
        client.on('disconnect',function() {
            console.log('Client has disconnected from the server!');
        });

        function bindEnterKeySend(e){
            var e = e || window.event;
            if(e.keyCode == 13){
                sendChatMessage();
            }
        }
        function sendChatMessage() {
            var message = $('#chat-input').val();
            var friend_name = $('#friend_name').val();
            client.emit('CHAT_MESSAGE',{'friend_name':friend_name,'chat_message':message});
        }
        function loginMessageServer(){
            var my_name = $('#my_name').val();
            client.emit('LOGIN_MESSAGE_SERVER',{'user_name':my_name});
        }

    </script>
</head>
<body>
<h1><%= title %></h1>

<p>Welcome to <%= title %></p>
<div class="row" style="width: 400px;height: 40px;">
    <div class="col-xs-5 col-sm-5 col-md-5">
        <input id="my_name" placeholder="Your Name" type="text" class="form-control input-sm"/>
    </div>
    <div class="col-xs-5 col-sm-5 col-md-5">
        <input id="friend_name" placeholder="Friend Name" type="text" class="form-control input-sm"/>
    </div>
    <div class="col-xs-2 col-sm-2 col-md-2">
        <span class="btn btn-sm btn-success" onclick="loginMessageServer()">Login Chat Server</span>
    </div>
    <div class="col-md-12" id="login_status"></div>
</div>
<div style="height: 400px;width: 450px;background-color: #f5f5f5;margin: 10px;padding: 5px;">
    <div id="chat-history" style="height: 355px;background-color: #fff;width: 100%;">
    </div>
    <div style="padding: 2px;">
        <div class="col-xs-10 col-sm-10 col-md-10">
            <input id="chat-input" type="text" class="form-control input-sm" onkeydown="bindEnterKeySend(event)"/>
        </div>
        <div class="col-xs-2 col-sm-2 col-md-2">
            <span class="btn btn-success btn-sm" onclick="sendChatMessage()"> Send</span>
        </div>

    </div>
</div>
</body>
</html>
