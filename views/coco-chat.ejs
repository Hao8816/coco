
<style type="text/css">
    .friend_list{
        margin: 0;
        padding: 0;
    }
    .friend_list .item{
        list-style: none;
        padding: 20px 10px;
        border: 1px solid #eee;
        cursor: pointer;
    }
    .friend_list .item:hover{
        background-color: #f5f5f5;
    }
    #chat-history li{
        list-style: none;
        margin: 8px;
    }

    #chat-history .item .message{
        background-color: #eee;
        position: relative;
        padding:5px 15px;
        border:1px solid #eee;
        border-radius: 3px;
    }
    #chat-history .item .message::before{
        position: absolute;
        content:'';
        border-top: 6px solid transparent;
        border-bottom: 6px solid transparent;
        border-right: 6px solid #dddddd;
        top: 10px;
        left: -6px;
    }
    .message-item-left,
    .message-item-right{
        clear: both;
        width: 100%;
        position: relative;
        padding: 10px 20px;
        overflow: auto;

    }
    .message-item-left .content{
        text-align: left;
        position: absolute;
        left: 80px;
        top: 10px;;
        background-color: #eee;
        padding: 8px;
        border-radius: 5px;
        max-width: 300px;
        overflow: auto;
        word-break: break-all;
    }
    .message-item-right .content{
        text-align: right;
        position: absolute;
        right: 80px;
        top: 10px;
        background-color: #ddd;
        padding: 8px;
        border-radius: 5px;
        max-width: 300px;
        overflow: auto;
        word-break: break-all;
    }
    .message-item-left .image{
        float: left;
    }
    .message-item-right .image{
        float: right;
    }
    .message-item-left .image,
    .message-item-right .image{
        width: 40px;
        height: 40px;
        border-radius: 40px;
        border: 1px solid #333;
    }
</style>
<script type="text/javascript">
    $(function () {
        $('.friend_list').find('.item').click(function(){
            var friend_name = $(this).attr('u-id');
            $('#friend_name').text(friend_name);
            $(this).find('.badge').text('');
            var my_name = sessionStorage.getItem('LOGIN_USER_INFO');
            var cache_key = my_name+'_'+friend_name;
            showChatHistory(cache_key)
        });
        // 从localStorage里面取得用户
        var user_name = sessionStorage.getItem('LOGIN_USER_INFO');
        if(user_name != null){
            client.emit('LOGIN_MESSAGE_SERVER',{'user_name':user_name});
        }
    });
</script>
<div class="container-fluid" style="margin-top: 10px;margin-bottom:10px;border-radius: 5px;">
    <div class="row">
        <div class="col-xs-1 col-sm-1 col-md-1" style="height: 700px">
            <div style="max-width: 60px;background-color: #ddd;border-radius: 30px;max-height: 60px;text-align: center;margin:20px auto;cursor: pointer;line-height: 80px;"  onclick="showUserInfo()">
                <i class="glyphicon glyphicon-user" style="font-size: 40px;color: #666"></i>
                <span id="my_name" style="display: none"></span>
            </div>
            <div style="text-align: center;margin-top: 20px;">
                <a  data-toggle="modal" data-target=".login_message_server" style="display:inline-block;margin:auto;width: 10px;height: 10px;background-color: #ffffff;border-radius: 100%;box-shadow: 0px 0px 5px 2px #ccc"></a>
            </div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-3" style="background-color: #fafafa;height: 700px;padding: 0px">
            <div style="padding: 10px;background-color: #eee">
                <input type="text" class="form-control" style="border-radius: 20px;">
                <i class="glyphicon glyphicon-search" style="position: absolute;top: 20px;left: 30px;"></i>
            </div>
            <ul class="friend_list">
                <li u-id="user1" class="item">user1<span class="badge pull-right"></span>
                </li>
                <li u-id="chenhao" class="item">chenhao
                    <span class="badge pull-right"></span>
                </li>
                <li u-id="hao8816" class="item">hao8816
                    <span class="badge pull-right"></span>
                </li>
                <li u-id="smite" class="item">smite
                    <span class="badge pull-right"></span>
                </li>
            </ul>
        </div>
        <div class="col-xs-7 col-sm-7 col-md-8 " style="background-color: #f5f5f5;height: 700px;padding: 0px">
            <div style="height: 55px;background-color: #eee;padding:10px">
                <span id="friend_name"></span>
            </div>
            <div id="chat-history" style="height: 500px;margin: 10px 0px;overflow-y:auto"></div>
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12">
                    <textarea id="chat-input" style="width: 100%;height: 120px;box-shadow: none;border: none;border-top: 1px solid #ddd;outline: none" onkeydown="bindEnterKeySend(event)"></textarea>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade login_message_server" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="input-group" style="border: 1px solid #ddd;border-radius: 3px;">
                <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                <input type="text" id="login_name" class="form-control input-sm" placeholder="Your Name">
                <span class="input-group-addon" style="cursor: pointer" onclick="loginMessageServer()">
                    <i class="glyphicon glyphicon-arrow-right"></i>
                </span>
            </div>
        </div>
    </div>
</div>

<div class="modal fade user_info_modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content" style="height: 100px;">

        </div>
    </div>
</div>
<div class="message_template" style="display: none;">
    <div class="row message-item-left">
        <img class="image" src="" alt=""/>
        <p class="content"></p>
    </div>
    <div class="row message-item-right">
        <p class="content"></p>
        <img class="image" src="" alt=""/>
    </div>
</div>
